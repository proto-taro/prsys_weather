<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

const supabase = supabase.createClient(
  'https://kgrvnxtmfgbwpegexwqy.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtncnZueHRtZmdid3BlZ2V4d3F5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMzUyNTQsImV4cCI6MjA3NjgxMTI1NH0.ePwTBmz-6m4S0AkbE6kGwr68Bsh05CyaD_ZoYTQUfDY'
)

async function login(email, password) {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  })
  if (error) {
    alert('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ' + error.message)
  } else {
    alert('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼')
    showSurveyForm()
  }
}

async function submitSurvey(condition, comment) {
  const {
    data: { user }
  } = await supabase.auth.getUser()

  const { error } = await supabase.from('responses').insert([
    {
      user_id: user.id,
      email: user.email,
      condition: parseInt(condition),
      comment: comment,
      submitted_at: new Date().toISOString()
    }
  ])

  if (error) {
    alert('é€ä¿¡å¤±æ•—: ' + error.message)
  } else {
    alert('é€ä¿¡å®Œäº†ï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ')
  }
}

<!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
<form id="login-form">
  <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required />
  <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required />
  <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
</form>

<!-- ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¡¨ç¤ºï¼‰ -->
<form id="survey-form" style="display:none;">
  <select id="condition">
    <option value="3">â˜€ï¸ 3</option>
    <option value="2">ğŸŒ¤ï¸ 2</option>
    <option value="1">ğŸŒ§ï¸ 1</option>
  </select>
  <textarea id="comment" placeholder="å‚™è€ƒï¼ˆä»»æ„ï¼‰"></textarea>
  <button type="submit">é€ä¿¡</button>
</form>

<script>
  document.getElementById('login-form').addEventListener('submit', (e) => {
    e.preventDefault()
    login(
      document.getElementById('email').value,
      document.getElementById('password').value
    )
  })

  function showSurveyForm() {
    document.getElementById('login-form').style.display = 'none'
    document.getElementById('survey-form').style.display = 'block'
  }

  document.getElementById('survey-form').addEventListener('submit', (e) => {
    e.preventDefault()
    submitSurvey(
      document.getElementById('condition').value,
      document.getElementById('comment').value
    )
  })
</script>
